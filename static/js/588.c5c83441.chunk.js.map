{"version":3,"file":"static/js/588.c5c83441.chunk.js","mappings":"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","sources":["views/library/ArticleList/store.ts","views/library/ArticleList/styled.ts","views/library/ArticleList/index.tsx"],"sourcesContent":["import { request } from '@/utils';\r\nimport { create } from 'zustand';\r\n\r\nexport interface articleItem extends Item {\r\n  title: string;\r\n  category: string;\r\n  tag: string;\r\n  introduce: string;\r\n  content: string;\r\n  picture: string;\r\n  type: number;\r\n  visits: number;\r\n  comments: number;\r\n  publish: number;\r\n  topping: number;\r\n}\r\n\r\ntype paramsType = {\r\n  pageNum: number;\r\n  pageSize: number;\r\n  filters: {\r\n    publish?: number;\r\n    category?: string;\r\n    tag?: string;\r\n    title?: string;\r\n  };\r\n  orderBys: { [key: string]: string };\r\n};\r\n\r\ntype StoreTypes = {\r\n  articleData: articleItem[];\r\n  total: number;\r\n  params: paramsType;\r\n  loading: boolean;\r\n  value: string;\r\n  setParams: (param: Partial<paramsType>) => void;\r\n  setParamsFilter: (filter: paramsType['filters']) => void;\r\n  reset: () => void;\r\n  fetchData: () => void;\r\n  onSearch: (q: string) => void;\r\n  onClickCategory: (category: string) => void;\r\n  onClickOrderBy: (order: string) => void;\r\n  onChangePage: (prop: {\r\n    pageNum: number;\r\n    pageSize: number;\r\n    listRef: React.RefObject<HTMLDivElement>;\r\n  }) => void;\r\n};\r\n\r\nconst store = create<StoreTypes>((set, get) => ({\r\n  articleData: [],\r\n  total: 0,\r\n  params: {\r\n    pageNum: 1,\r\n    pageSize: 12,\r\n    filters: { publish: 1 },\r\n    orderBys: { topping: 'desc', createTime: 'desc' },\r\n  },\r\n  loading: false,\r\n  value: '',\r\n\r\n  setParams(param) {\r\n    set({ params: { ...get().params, pageNum: 1, ...param } });\r\n  },\r\n\r\n  setParamsFilter(filter) {\r\n    const { setParams, params } = get();\r\n    setParams({\r\n      filters: { ...params.filters, ...filter },\r\n    });\r\n  },\r\n\r\n  reset() {\r\n    set(get());\r\n  },\r\n\r\n  fetchData: async () => {\r\n    const api = {\r\n      url: '/current/query/article',\r\n      method: 'get',\r\n      params: get().params,\r\n    };\r\n\r\n    set({ loading: true });\r\n\r\n    const { data: articleData, total } = await request(api);\r\n\r\n    set({ loading: false, articleData, total });\r\n  },\r\n\r\n  onSearch: q => {\r\n    get().setParamsFilter({ tag: '', title: q });\r\n  },\r\n\r\n  onClickCategory: category => {\r\n    // 如果点击的是当前分类，就取消分类查询所有\r\n    get().setParamsFilter({\r\n      category: category === get().params.filters.category ? '' : category,\r\n      title: '',\r\n    });\r\n    // 重置搜索\r\n    set({ value: '' });\r\n  },\r\n\r\n  onClickOrderBy: (order: string) => {\r\n    get().setParams({\r\n      orderBys: {\r\n        topping: order === 'createTime' ? 'desc' : '',\r\n        [order]: 'desc',\r\n      },\r\n    });\r\n\r\n    // 重置搜索\r\n    set({ value: '' });\r\n  },\r\n\r\n  onChangePage: ({ pageNum, pageSize, listRef }) => {\r\n    get().setParams({ pageNum, pageSize });\r\n\r\n    //TODO:未实现异步滚动（等接口加载完且渲染完dom，尝试监听pageNum但页面挂载完成时必定执行一次滚动）\r\n\r\n    // 滚动回列表顶部\r\n    window.scrollTo({\r\n      top:\r\n        listRef.current!.getBoundingClientRect().top +\r\n        document.documentElement.scrollTop -\r\n        300,\r\n      behavior: 'smooth', // 平滑滚动\r\n    });\r\n  },\r\n}));\r\n\r\nexport default store;\r\n","import styled from 'styled-components';\r\n\r\nexport const ArticleListWrapper = styled.div`\r\n  .bar {\r\n    background-color: #fff;\r\n    border-radius: 15px;\r\n    padding: 20px;\r\n    box-shadow: var(--box-shadow);\r\n  }\r\n  .page-bar {\r\n    padding: 10px;\r\n  }\r\n  .articleList {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    /* justify-content: space-between; */\r\n    .articleItem {\r\n      width: calc(25% - 12px);\r\n      margin-bottom: 15px;\r\n      margin-right: 15px;\r\n      &:nth-child(4n) {\r\n        margin-right: 0;\r\n      }\r\n      &:last-child {\r\n        margin-right: auto;\r\n      }\r\n    }\r\n  }\r\n\r\n  .search-bar {\r\n    padding: 0 150px;\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  .filter-bar {\r\n    width: 100%;\r\n    margin-bottom: 20px;\r\n    .filter-type {\r\n      font-size: 14px;\r\n      width: 40px;\r\n      border-right: 1px solid #999;\r\n    }\r\n  }\r\n`;\r\n\r\nexport const FilterText = styled.div<{ active: boolean }>`\r\n  color: ${({ active }) => (active ? 'var(--ant-primary-color)' : '#666')};\r\n  font-size: 14px;\r\n  cursor: pointer;\r\n  &:hover {\r\n    color: var(--ant-primary-4);\r\n  }\r\n`;\r\n\r\nexport const ArticleItem = styled.div`\r\n  border-radius: 10px;\r\n  display: flex;\r\n  margin: 0 auto;\r\n  height: 200px;\r\n  margin-bottom: 20px;\r\n  padding: 10px 0;\r\n\r\n  .image {\r\n    height: 100%;\r\n    width: 30%;\r\n    border-radius: 15px;\r\n    display: block;\r\n  }\r\n\r\n  .info {\r\n    width: 70%;\r\n    height: 100%;\r\n    margin-left: 20px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    padding: 15px 0;\r\n    .top {\r\n      h2 {\r\n        transition: 0.7s all;\r\n\r\n        cursor: pointer;\r\n        color: #3c4858;\r\n        &:hover {\r\n          color: var(--ant-primary-color);\r\n        }\r\n      }\r\n\r\n      .introduce {\r\n        margin-top: 10px;\r\n      }\r\n\r\n      .tags {\r\n        font-size: 13px;\r\n      }\r\n    }\r\n\r\n    .last {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-top: 8px;\r\n      font-size: 13px;\r\n      .time {\r\n        margin-right: 20px;\r\n      }\r\n    }\r\n  }\r\n`;\r\n","import { ArticleCard, Plate } from '@/components';\r\nimport { useQuery } from '@/hooks';\r\nimport { Pagination, Space, Spin } from 'antd';\r\nimport Search from 'antd/es/input/Search';\r\nimport { useEffect, useRef } from 'react';\r\nimport useStore from './store';\r\nimport { ArticleListWrapper, FilterText } from './styled';\r\n\r\nconst { setState } = useStore;\r\n\r\nconst sortData = [\r\n  {\r\n    name: '日期',\r\n    key: 'createTime',\r\n  },\r\n  {\r\n    name: '浏览',\r\n    key: 'visits',\r\n  },\r\n  {\r\n    name: '点赞',\r\n    key: 'like',\r\n  },\r\n  {\r\n    name: '评论',\r\n    key: 'comments',\r\n  },\r\n];\r\n\r\nconst ArticleList = () => {\r\n  const {\r\n    articleData,\r\n    params,\r\n    total,\r\n    loading,\r\n    value,\r\n    fetchData,\r\n    onChangePage,\r\n    onClickCategory,\r\n    onClickOrderBy,\r\n    onSearch,\r\n  } = useStore();\r\n\r\n  const listRef = useRef<HTMLDivElement>(null);\r\n\r\n  const { data: category } = useQuery({\r\n    url: '/current/query/category',\r\n    params: { filters: { belong: 'article' } },\r\n  });\r\n\r\n  const { pageNum, pageSize, filters } = params;\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [params]);\r\n\r\n  return (\r\n    <Plate title='文章列表' bg='bg23.jpg' hasBackgroundColor={false}>\r\n      <ArticleListWrapper>\r\n        <div className='bar'>\r\n          <div className='search-bar'>\r\n            <Search\r\n              placeholder='输入关键词搜索文章'\r\n              onSearch={onSearch}\r\n              enterButton\r\n              value={value}\r\n              onChange={e => setState({ value: e.target.value })}\r\n            />\r\n          </div>\r\n          <Space wrap size={16} className='filter-bar'>\r\n            <div className='filter-type'>分类</div>\r\n            <FilterText\r\n              active={!filters.category}\r\n              onClick={() => onClickCategory('')}\r\n            >\r\n              全部\r\n            </FilterText>\r\n            {category.map(({ name }) => (\r\n              <FilterText\r\n                active={filters.category === name}\r\n                onClick={() => onClickCategory(name)}\r\n                key={name}\r\n              >\r\n                {name}\r\n              </FilterText>\r\n            ))}\r\n          </Space>\r\n\r\n          <Space wrap size={16} className='filter-bar'>\r\n            <div className='filter-type'>排序</div>\r\n            {sortData.map(({ name, key }) => (\r\n              <FilterText\r\n                active={!!params.orderBys[key]}\r\n                onClick={() => onClickOrderBy(key)}\r\n                key={name}\r\n              >\r\n                {name}\r\n              </FilterText>\r\n            ))}\r\n          </Space>\r\n        </div>\r\n\r\n        <div className='page-bar'>第{pageNum}页</div>\r\n\r\n        <Spin spinning={loading}>\r\n          <div className='articleList' ref={listRef}>\r\n            {articleData.map(item => (\r\n              <ArticleCard {...item} key={item.id} className='articleItem' />\r\n            ))}\r\n          </div>\r\n        </Spin>\r\n\r\n        <Pagination\r\n          current={pageNum}\r\n          pageSize={pageSize}\r\n          total={total}\r\n          onChange={(pageNum, pageSize) =>\r\n            onChangePage({ pageNum, pageSize, listRef })\r\n          }\r\n          pageSizeOptions={[5, 10, 20, 30]}\r\n        />\r\n      </ArticleListWrapper>\r\n    </Plate>\r\n  );\r\n};\r\n\r\nexport default ArticleList;\r\n"],"names":["store","create","set","get","articleData","total","params","pageNum","pageSize","filters","publish","orderBys","topping","createTime","loading","value","setParams","param","_objectSpread","setParamsFilter","filter","_get","reset","fetchData","_fetchData","_asyncToGenerator","_regeneratorRuntime","mark","_callee","api","_yield$request","wrap","_context","prev","next","url","method","request","sent","data","stop","apply","arguments","onSearch","q","tag","title","onClickCategory","category","onClickOrderBy","order","_defineProperty","onChangePage","_ref","listRef","window","scrollTo","top","current","getBoundingClientRect","document","documentElement","scrollTop","behavior","ArticleListWrapper","styled","displayName","componentId","FilterText","active","setState","useStore","sortData","name","key","_useStore","useRef","useQuery","belong","useEffect","_jsx","Plate","bg","hasBackgroundColor","children","_jsxs","className","Search","placeholder","enterButton","onChange","e","target","Space","size","onClick","map","_ref2","Spin","spinning","ref","item","_createElement","ArticleCard","id","Pagination","pageSizeOptions"],"sourceRoot":""}